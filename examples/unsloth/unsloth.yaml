# Runs the unsloth example app via SkyPilot
#
# The example app starts by obtaining the LAION dataset,
# loads the Mistral model with 4-bit precision, performs model
# patching with fast LoRA weights, and finally initializes and
# trains the model using the SFTTrainer with specified
# hyperparameters and the LAION dataset.
#
# Usage:
#   sky launch -c myclus unsloth.yaml
#   sky down myclus

resources:
  accelerators: T4:1
  disk_size: 128

file_mounts:
  /outputs:
    name: my-unsloth-checkpoints

workdir: .

setup: |
  set -ex
  pip install --upgrade --force-reinstall --no-cache-dir torch==2.2.0 triton \
    --index-url https://download.pytorch.org/whl/cu118
  pip install ipython
  pip install "unsloth[cu118_torch220] @ git+https://github.com/unslothai/unsloth.git"

run: |
  python unsloth_example.py --output-dir /outputs
